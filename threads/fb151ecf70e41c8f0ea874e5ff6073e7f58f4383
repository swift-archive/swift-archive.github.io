<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Swift Mailing List Archive</title>
    <link rel="stylesheet" href="/css/app-13f065ae5e595562a5022c544e3b976c.css?vsn=d">
  </head>

  <body>
    <div class="container">
      <header class="header">
        <img src="/images/swift-d0237fc716ba0932a940049990beba1b.svg?vsn=d" height="70">
      </header>

      <p class="alert alert-info" role="alert"></p>
      <p class="alert alert-danger" role="alert"></p>

    </div> <!-- /container -->
    <main role="main">
<div class="comment-wrapper"><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/537cdf5303cfb8f536e251c89042cbfd?s=50"></div><header><strong>long double usage in swift</strong> from <string>Saleem Abdulrasool</string> &lt;compnerd at compnerd.org&gt;<p>March 23, 2016 at 02:00:00pm</p></header><div class="content"><p>Hi,<br></p><p>I was looking at an ABI related issue on Windows.  In trying to construct a<br>test case, it seems that I am unable to import a declaration using a long<br>double into swift.  I was wondering if there is something about long double<br>usage in swift that I am unaware of.<br></p><p>Inputs/abi.h:<br></p><p>float fp32_call(void);<br>double fp64_call(void);<br>long double fp80_call(void);<br></p><p>Inputs/module.map:<br></p><p>module abi {<br>  header &quot;abi.h&quot;<br>}<br></p><p>test.swift:<br></p><p>%swift -I Inputs -parse %s<br>import abi<br></p><p>@inline(never)<br>func blackhole&lt;T&gt;(t : T) { }<br></p><p>func test_floating_point() {<br>}<br></p><p>Thanks!<br></p><p>-- <br>Saleem Abdulrasool<br>compnerd (at) compnerd (dot) org<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/fb154383/attachment.html&gt;<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/b3d3a2cce932eca144b8c13a63966404?s=50"></div><header><strong>long double usage in swift</strong> from <string>Alex Blewitt</string> &lt;alex.blewitt at gmail.com&gt;<p>March 23, 2016 at 09:00:00pm</p></header><div class="content"><p>There’s a Float80 type, if you’re looking for an 80-bit floating point value.<br></p><p>Alex<br></p><p>&gt; On 23 Mar 2016, at 21:25, Saleem Abdulrasool via swift-dev &lt;swift-dev at swift.org&gt; wrote:<br>&gt; <br>&gt; Hi,<br>&gt; <br>&gt; I was looking at an ABI related issue on Windows.  In trying to construct a test case, it seems that I am unable to import a declaration using a long double into swift.  I was wondering if there is something about long double usage in swift that I am unaware of.<br>&gt; <br>&gt; Inputs/abi.h:<br>&gt; <br>&gt; float fp32_call(void);<br>&gt; double fp64_call(void);<br>&gt; long double fp80_call(void);<br>&gt; <br>&gt; Inputs/module.map:<br>&gt; <br>&gt; module abi {<br>&gt;   header &quot;abi.h&quot;<br>&gt; }<br>&gt; <br>&gt; test.swift:<br>&gt; <br>&gt; %swift -I Inputs -parse %s<br>&gt; import abi<br>&gt; <br>&gt; @inline(never)<br>&gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt; <br>&gt; func test_floating_point() {<br>&gt; }<br>&gt; <br>&gt; Thanks!<br>&gt; <br>&gt; -- <br>&gt; Saleem Abdulrasool<br>&gt; compnerd (at) compnerd (dot) org<br>&gt; _______________________________________________<br>&gt; swift-dev mailing list<br>&gt; swift-dev at swift.org<br>&gt; https://lists.swift.org/mailman/listinfo/swift-dev<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/537cdf5303cfb8f536e251c89042cbfd?s=50"></div><header><strong>long double usage in swift</strong> from <string>Saleem Abdulrasool</string> &lt;compnerd at compnerd.org&gt;<p>March 23, 2016 at 02:00:00pm</p></header><div class="content"><p>On Wed, Mar 23, 2016 at 2:28 PM, Alex Blewitt &lt;alex.blewitt at gmail.com&gt;<br>wrote:<br></p><p>&gt; There’s a Float80 type, if you’re looking for an 80-bit floating point<br>&gt; value.<br>&gt;<br></p><p>Im explicitly trying to import a call from C through the clang-importer (to<br>ensure that long doubles are imported correctly).  As such, unfortunately,<br>I don&#39;t think that the use of Float80 is appropriate in this case.<br></p><p><br>&gt; Alex<br>&gt;<br>&gt; &gt; On 23 Mar 2016, at 21:25, Saleem Abdulrasool via swift-dev &lt;<br>&gt; swift-dev at swift.org&gt; wrote:<br>&gt; &gt;<br>&gt; &gt; Hi,<br>&gt; &gt;<br>&gt; &gt; I was looking at an ABI related issue on Windows.  In trying to<br>&gt; construct a test case, it seems that I am unable to import a declaration<br>&gt; using a long double into swift.  I was wondering if there is something<br>&gt; about long double usage in swift that I am unaware of.<br>&gt; &gt;<br>&gt; &gt; Inputs/abi.h:<br>&gt; &gt;<br>&gt; &gt; float fp32_call(void);<br>&gt; &gt; double fp64_call(void);<br>&gt; &gt; long double fp80_call(void);<br>&gt; &gt;<br>&gt; &gt; Inputs/module.map:<br>&gt; &gt;<br>&gt; &gt; module abi {<br>&gt; &gt;   header &quot;abi.h&quot;<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; test.swift:<br>&gt; &gt;<br>&gt; &gt; %swift -I Inputs -parse %s<br>&gt; &gt; import abi<br>&gt; &gt;<br>&gt; &gt; @inline(never)<br>&gt; &gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt; &gt;<br>&gt; &gt; func test_floating_point() {<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; Thanks!<br>&gt; &gt;<br>&gt; &gt; --<br>&gt; &gt; Saleem Abdulrasool<br>&gt; &gt; compnerd (at) compnerd (dot) org<br>&gt; &gt; _______________________________________________<br>&gt; &gt; swift-dev mailing list<br>&gt; &gt; swift-dev at swift.org<br>&gt; &gt; https://lists.swift.org/mailman/listinfo/swift-dev<br>&gt;<br>&gt;<br></p><p><br>-- <br>Saleem Abdulrasool<br>compnerd (at) compnerd (dot) org<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/0ca12dd4/attachment.html&gt;<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/b3d3a2cce932eca144b8c13a63966404?s=50"></div><header><strong>long double usage in swift</strong> from <string>Alex Blewitt</string> &lt;alex.blewitt at gmail.com&gt;<p>March 23, 2016 at 09:00:00pm</p></header><div class="content"><p>Why not?<br></p><p>https://github.com/apple/swift/blob/8d9ef80304d7b36e13619ea50e6e76f3ec9221ba/test/Inputs/clang-importer-sdk/usr/include/ctypes.h#L146<br></p><p>&gt; On 23 Mar 2016, at 21:29, Saleem Abdulrasool &lt;compnerd at compnerd.org&gt; wrote:<br>&gt; <br>&gt; On Wed, Mar 23, 2016 at 2:28 PM, Alex Blewitt &lt;alex.blewitt at gmail.com &lt;mailto:alex.blewitt at gmail.com&gt;&gt; wrote:<br>&gt; There’s a Float80 type, if you’re looking for an 80-bit floating point value.<br>&gt; <br>&gt; Im explicitly trying to import a call from C through the clang-importer (to ensure that long doubles are imported correctly).  As such, unfortunately, I don&#39;t think that the use of Float80 is appropriate in this case.<br>&gt;  <br>&gt; Alex<br>&gt; <br>&gt; &gt; On 23 Mar 2016, at 21:25, Saleem Abdulrasool via swift-dev &lt;swift-dev at swift.org &lt;mailto:swift-dev at swift.org&gt;&gt; wrote:<br>&gt; &gt;<br>&gt; &gt; Hi,<br>&gt; &gt;<br>&gt; &gt; I was looking at an ABI related issue on Windows.  In trying to construct a test case, it seems that I am unable to import a declaration using a long double into swift.  I was wondering if there is something about long double usage in swift that I am unaware of.<br>&gt; &gt;<br>&gt; &gt; Inputs/abi.h:<br>&gt; &gt;<br>&gt; &gt; float fp32_call(void);<br>&gt; &gt; double fp64_call(void);<br>&gt; &gt; long double fp80_call(void);<br>&gt; &gt;<br>&gt; &gt; Inputs/module.map:<br>&gt; &gt;<br>&gt; &gt; module abi {<br>&gt; &gt;   header &quot;abi.h&quot;<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; test.swift:<br>&gt; &gt;<br>&gt; &gt; %swift -I Inputs -parse %s<br>&gt; &gt; import abi<br>&gt; &gt;<br>&gt; &gt; @inline(never)<br>&gt; &gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt; &gt;<br>&gt; &gt; func test_floating_point() {<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; Thanks!<br>&gt; &gt;<br>&gt; &gt; --<br>&gt; &gt; Saleem Abdulrasool<br>&gt; &gt; compnerd (at) compnerd (dot) org<br>&gt; &gt; _______________________________________________<br>&gt; &gt; swift-dev mailing list<br>&gt; &gt; swift-dev at swift.org &lt;mailto:swift-dev at swift.org&gt;<br>&gt; &gt; https://lists.swift.org/mailman/listinfo/swift-dev &lt;https://lists.swift.org/mailman/listinfo/swift-dev&gt;<br>&gt; <br>&gt; <br>&gt; <br>&gt; <br>&gt; -- <br>&gt; Saleem Abdulrasool<br>&gt; compnerd (at) compnerd (dot) org<br></p><p>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/03112956/attachment.html&gt;<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/537cdf5303cfb8f536e251c89042cbfd?s=50"></div><header><strong>long double usage in swift</strong> from <string>Saleem Abdulrasool</string> &lt;compnerd at compnerd.org&gt;<p>March 23, 2016 at 02:00:00pm</p></header><div class="content"><p>On Wed, Mar 23, 2016 at 2:35 PM, Alex Blewitt &lt;alex.blewitt at gmail.com&gt;<br>wrote:<br></p><p>&gt; Why not?<br>&gt;<br>&gt;<br>&gt; https://github.com/apple/swift/blob/8d9ef80304d7b36e13619ea50e6e76f3ec9221ba/test/Inputs/clang-importer-sdk/usr/include/ctypes.h#L146<br>&gt;<br></p><p><br>AIUI, Float80 isn&#39;t exactly applicable to this test (since I want an<br>explicit long double to be imported, not whatever the representation of<br>FP80 happens to be).  However, thanks for that pointer, it was able to help<br>me with my issue.  It seems that the clang importer explicitly excludes the<br>long double type from being mapped.  Since long double is made illegal, the<br>decl is pruned from the generated module, resulting in the unresolved<br>reference.<br></p><p><br>&gt; On 23 Mar 2016, at 21:29, Saleem Abdulrasool &lt;compnerd at compnerd.org&gt;<br>&gt; wrote:<br>&gt;<br>&gt; On Wed, Mar 23, 2016 at 2:28 PM, Alex Blewitt &lt;alex.blewitt at gmail.com&gt;<br>&gt; wrote:<br>&gt;<br>&gt;&gt; There’s a Float80 type, if you’re looking for an 80-bit floating point<br>&gt;&gt; value.<br>&gt;&gt;<br>&gt;<br>&gt; Im explicitly trying to import a call from C through the clang-importer<br>&gt; (to ensure that long doubles are imported correctly).  As such,<br>&gt; unfortunately, I don&#39;t think that the use of Float80 is appropriate in this<br>&gt; case.<br>&gt;<br>&gt;<br>&gt;&gt; Alex<br>&gt;&gt;<br>&gt;&gt; &gt; On 23 Mar 2016, at 21:25, Saleem Abdulrasool via swift-dev &lt;<br>&gt;&gt; swift-dev at swift.org&gt; wrote:<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; Hi,<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; I was looking at an ABI related issue on Windows.  In trying to<br>&gt;&gt; construct a test case, it seems that I am unable to import a declaration<br>&gt;&gt; using a long double into swift.  I was wondering if there is something<br>&gt;&gt; about long double usage in swift that I am unaware of.<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; Inputs/abi.h:<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; float fp32_call(void);<br>&gt;&gt; &gt; double fp64_call(void);<br>&gt;&gt; &gt; long double fp80_call(void);<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; Inputs/module.map:<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; module abi {<br>&gt;&gt; &gt;   header &quot;abi.h&quot;<br>&gt;&gt; &gt; }<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; test.swift:<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; %swift -I Inputs -parse %s<br>&gt;&gt; &gt; import abi<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; @inline(never)<br>&gt;&gt; &gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; func test_floating_point() {<br>&gt;&gt; &gt; }<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; Thanks!<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; --<br>&gt;&gt; &gt; Saleem Abdulrasool<br>&gt;&gt; &gt; compnerd (at) compnerd (dot) org<br>&gt;&gt; &gt; _______________________________________________<br>&gt;&gt; &gt; swift-dev mailing list<br>&gt;&gt; &gt; swift-dev at swift.org<br>&gt;&gt; &gt; https://lists.swift.org/mailman/listinfo/swift-dev<br>&gt;&gt;<br>&gt;&gt;<br>&gt;<br>&gt;<br>&gt; --<br>&gt; Saleem Abdulrasool<br>&gt; compnerd (at) compnerd (dot) org<br>&gt;<br>&gt;<br>&gt;<br></p><p><br>-- <br>Saleem Abdulrasool<br>compnerd (at) compnerd (dot) org<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/cdd1d448/attachment.html&gt;<br></p></div></li></ul></li></ul></li></ul></li><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/537cdf5303cfb8f536e251c89042cbfd?s=50"></div><header><strong>long double usage in swift</strong> from <string>Saleem Abdulrasool</string> &lt;compnerd at compnerd.org&gt;<p>March 23, 2016 at 02:00:00pm</p></header><div class="content"><p>Sorry, hit send too quickly:<br></p><p>Inputs/abi.h:<br></p><p>float fp32_call(void);<br>double fp64_call(void);<br>long double fp80_call(void);<br></p><p>Inputs/module.map:<br></p><p>module abi {<br>  header &quot;abi.h&quot;<br>}<br></p><p>test.swift:<br></p><p>%swift -I Inputs -parse %s<br>import abi<br></p><p>@inline(never)<br>func blackhole&lt;T&gt;(t : T) { }<br></p><p>func test_floating_point() {<br>  blackhole(fp32_call())<br>  blackhole(fp64_call())<br>#if LONG_DOUBLE<br>  blackhole(fp80_call())<br>#endif<br>}<br></p><p>Compiling with -DLONG_DOUBLE will result in an error:<br>  error: use of unresolved identifier &#39;fp80_call&#39;.<br></p><p>Ive tested this with clang, and using this in a module (-fmodules<br>-fmodule-cache-path=/tmp) seems to work fine, so I don&#39;t believe that this<br>is an issue with modules.<br></p><p>On Wed, Mar 23, 2016 at 2:25 PM, Saleem Abdulrasool &lt;compnerd at compnerd.org&gt;<br>wrote:<br></p><p>&gt; Hi,<br>&gt;<br>&gt; I was looking at an ABI related issue on Windows.  In trying to construct<br>&gt; a test case, it seems that I am unable to import a declaration using a long<br>&gt; double into swift.  I was wondering if there is something about long double<br>&gt; usage in swift that I am unaware of.<br>&gt;<br>&gt; Inputs/abi.h:<br>&gt;<br>&gt; float fp32_call(void);<br>&gt; double fp64_call(void);<br>&gt; long double fp80_call(void);<br>&gt;<br>&gt; Inputs/module.map:<br>&gt;<br>&gt; module abi {<br>&gt;   header &quot;abi.h&quot;<br>&gt; }<br>&gt;<br>&gt; test.swift:<br>&gt;<br>&gt; %swift -I Inputs -parse %s<br>&gt; import abi<br>&gt;<br>&gt; @inline(never)<br>&gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt;<br>&gt; func test_floating_point() {<br>&gt; }<br>&gt;<br>&gt; Thanks!<br>&gt;<br>&gt; --<br>&gt; Saleem Abdulrasool<br>&gt; compnerd (at) compnerd (dot) org<br>&gt;<br></p><p><br></p><p>-- <br>Saleem Abdulrasool<br>compnerd (at) compnerd (dot) org<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/797b1b20/attachment.html&gt;<br></p></div></li><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/06c1dcc7dce6a93d194b9c013376e3f0?s=50"></div><header><strong>long double usage in swift</strong> from <string>Joe Groff</string> &lt;jgroff at apple.com&gt;<p>March 23, 2016 at 03:00:00pm</p></header><div class="content"><p>&gt; On Mar 23, 2016, at 2:25 PM, Saleem Abdulrasool via swift-dev &lt;swift-dev at swift.org&gt; wrote:<br>&gt; <br>&gt; Hi,<br>&gt; <br>&gt; I was looking at an ABI related issue on Windows.  In trying to construct a test case, it seems that I am unable to import a declaration using a long double into swift.  I was wondering if there is something about long double usage in swift that I am unaware of.<br>&gt; <br>&gt; Inputs/abi.h:<br>&gt; <br>&gt; float fp32_call(void);<br>&gt; double fp64_call(void);<br>&gt; long double fp80_call(void);<br>&gt; <br>&gt; Inputs/module.map:<br>&gt; <br>&gt; module abi {<br>&gt;   header &quot;abi.h&quot;<br>&gt; }<br>&gt; <br>&gt; test.swift:<br>&gt; <br>&gt; %swift -I Inputs -parse %s<br>&gt; import abi<br>&gt; <br>&gt; @inline(never)<br>&gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt; <br>&gt; func test_floating_point() {<br>&gt; }<br>&gt; <br>&gt; Thanks!<br></p><p>For better or worse, the failure mode for unsupported C declarations in the Clang importer is just to discard them. It sounds like we didn&#39;t add support for long double imports.<br></p><p>-Joe<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/537cdf5303cfb8f536e251c89042cbfd?s=50"></div><header><strong>long double usage in swift</strong> from <string>Saleem Abdulrasool</string> &lt;compnerd at compnerd.org&gt;<p>March 23, 2016 at 05:00:00pm</p></header><div class="content"><p>On Wed, Mar 23, 2016 at 3:54 PM, Joe Groff &lt;jgroff at apple.com&gt; wrote:<br></p><p>&gt;<br>&gt; &gt; On Mar 23, 2016, at 2:25 PM, Saleem Abdulrasool via swift-dev &lt;<br>&gt; swift-dev at swift.org&gt; wrote:<br>&gt; &gt;<br>&gt; &gt; Hi,<br>&gt; &gt;<br>&gt; &gt; I was looking at an ABI related issue on Windows.  In trying to<br>&gt; construct a test case, it seems that I am unable to import a declaration<br>&gt; using a long double into swift.  I was wondering if there is something<br>&gt; about long double usage in swift that I am unaware of.<br>&gt; &gt;<br>&gt; &gt; Inputs/abi.h:<br>&gt; &gt;<br>&gt; &gt; float fp32_call(void);<br>&gt; &gt; double fp64_call(void);<br>&gt; &gt; long double fp80_call(void);<br>&gt; &gt;<br>&gt; &gt; Inputs/module.map:<br>&gt; &gt;<br>&gt; &gt; module abi {<br>&gt; &gt;   header &quot;abi.h&quot;<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; test.swift:<br>&gt; &gt;<br>&gt; &gt; %swift -I Inputs -parse %s<br>&gt; &gt; import abi<br>&gt; &gt;<br>&gt; &gt; @inline(never)<br>&gt; &gt; func blackhole&lt;T&gt;(t : T) { }<br>&gt; &gt;<br>&gt; &gt; func test_floating_point() {<br>&gt; &gt; }<br>&gt; &gt;<br>&gt; &gt; Thanks!<br>&gt;<br>&gt; For better or worse, the failure mode for unsupported C declarations in<br>&gt; the Clang importer is just to discard them. It sounds like we didn&#39;t add<br>&gt; support for long double imports.<br></p><p><br>Yeah, I figured that out later thanks to the pointer that Alex provided.<br></p><p><br>&gt;<br>&gt; -Joe<br>&gt;<br>&gt;<br>-- <br>Saleem Abdulrasool<br>compnerd (at) compnerd (dot) org<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20160323/24a574b2/attachment.html&gt;<br></p></div></li></ul></li></ul></li></ul></div>    </main>
    <script src="/js/app-c283ee129de63ad743722e9511e67a5d.js?vsn=d"></script>
  </body>
  <footer>
    <p>Swift and the Swift logo are trademarks of Apple Inc.</p>
  </footer>
</html>
