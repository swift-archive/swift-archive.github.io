<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Swift Mailing List Archive</title>
    <link rel="stylesheet" href="/css/app-13f065ae5e595562a5022c544e3b976c.css">
  </head>

  <body>
    <div class="container">
      <header class="header">
        <img src="/images/swift-d0237fc716ba0932a940049990beba1b.svg" height="70">
      </header>

      <p class="alert alert-info" role="alert"></p>
      <p class="alert alert-danger" role="alert"></p>

    </div> <!-- /container -->
    <main role="main">
<div class="comment-wrapper"><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/2e51f5d1f79b09442f62eef9702b8316?s=50"></div><header><strong>Proper syntax for 2D table with initial values</strong> from <string>Ken Burgett</string> &lt;kenb at iotone.io&gt;<p>May 23, 2016 at 11:00:00am</p></header><div class="content"><p>I have a large 2D table defined within a C .h file, as follows:<br></p><p>static const uint8_t blake2b_kat[256][64] =<br>{<br>   {<br>     0x78, 0x6A, 0x02, 0xF7, 0x42, 0x01, 0x59, 0x03,<br>     0xC6, 0xC6, 0xFD, 0x85, 0x25, 0x52, 0xD2, 0x72,<br>     0x91, 0x2F, 0x47, 0x40, 0xE1, 0x58, 0x47, 0x61,<br>     0x8A, 0x86, 0xE2, 0x17, 0xF7, 0x1F, 0x54, 0x19,<br>     0xD2, 0x5E, 0x10, 0x31, 0xAF, 0xEE, 0x58, 0x53,<br>     0x13, 0x89, 0x64, 0x44, 0x93, 0x4E, 0xB0, 0x4B,<br>     0x90, 0x3A, 0x68, 0x5B, 0x14, 0x48, 0xB7, 0x55,<br>     0xD5, 0x6F, 0x70, 0x1A, 0xFE, 0x9B, 0xE2, 0xCE<br>   }<br>    ... shortened for clarity ...<br>}<br>There are 16384	elements in this array.  The C compiler accepts it with <br>no difficulty<br></p><p>I converted it to a .swift file like so:<br></p><p>let blake2b_kat: [[UInt8]] =<br>[<br>  [<br>   0x78, 0x6A, 0x02, 0xF7, 0x42, 0x01, 0x59, 0x03,<br>   0xC6, 0xC6, 0xFD, 0x85, 0x25, 0x52, 0xD2, 0x72,<br>   0x91, 0x2F, 0x47, 0x40, 0xE1, 0x58, 0x47, 0x61,<br>   0x8A, 0x86, 0xE2, 0x17, 0xF7, 0x1F, 0x54, 0x19,<br>   0xD2, 0x5E, 0x10, 0x31, 0xAF, 0xEE, 0x58, 0x53,<br>   0x13, 0x89, 0x64, 0x44, 0x93, 0x4E, 0xB0, 0x4B,<br>   0x90, 0x3A, 0x68, 0x5B, 0x14, 0x48, 0xB7, 0x55,<br>   0xD5, 0x6F, 0x70, 0x1A, 0xFE, 0x9B, 0xE2, 0xCE<br>  ]<br>...<br>]<br></p><p>When I attempt a swift compile, the compiler seems to go away and never <br>return.  I tried the same test with the REPL and saw all the text list <br>(2600 lines), but then the same thing happened.  I left the REPL running <br>for 10 minutes or so, with no output. I have tried the same swift table <br>definition with fewer rows and columns, and it produces the correct 2D <br>array.<br></p><p>My question is whether this is just an issue with the current Swift <br>compiler (I am using the May 9th version for Ubuntu 14.04) or is this a <br>recognized limitation in scale?  In order to get my 2D table filled and <br>work around this issue, I will have to read the file with file I/O and <br>do my own parsing.<br>-- <br>Ken Burgett<br>Principal Software Engineer<br>Email: kenb at iotone.io<br>Office: 530.693.4449<br>Mobile: 831.332.6846<br>URL: www.iotone.co<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/5d9baa679148bd83458d11df12327ce0?s=50"></div><header><strong>Proper syntax for 2D table with initial values</strong> from <string>Daniel Dunbar</string> &lt;daniel_dunbar at apple.com&gt;<p>May 23, 2016 at 11:00:00am</p></header><div class="content"><p>The type inference used in Swift can perform poorly when used in this fashion.<br></p><p>You may be able to get acceptable performance by inserting explicit casts, like:<br>  [...] as [UInt8]<br>around each of your individual arrays.<br></p><p>If not, my suggestion would be to embed your data in a C function, and expose it to Swift using a simple C function which you import.<br></p><p>In any case it is probably worth filing a bug with your example test case.<br></p><p> - Daniel<br></p><p>&gt; On May 23, 2016, at 11:04 AM, Ken Burgett via swift-users &lt;swift-users at swift.org&gt; wrote:<br>&gt; <br>&gt; I have a large 2D table defined within a C .h file, as follows:<br>&gt; <br>&gt; static const uint8_t blake2b_kat[256][64] =<br>&gt; {<br>&gt;  {<br>&gt;    0x78, 0x6A, 0x02, 0xF7, 0x42, 0x01, 0x59, 0x03,<br>&gt;    0xC6, 0xC6, 0xFD, 0x85, 0x25, 0x52, 0xD2, 0x72,<br>&gt;    0x91, 0x2F, 0x47, 0x40, 0xE1, 0x58, 0x47, 0x61,<br>&gt;    0x8A, 0x86, 0xE2, 0x17, 0xF7, 0x1F, 0x54, 0x19,<br>&gt;    0xD2, 0x5E, 0x10, 0x31, 0xAF, 0xEE, 0x58, 0x53,<br>&gt;    0x13, 0x89, 0x64, 0x44, 0x93, 0x4E, 0xB0, 0x4B,<br>&gt;    0x90, 0x3A, 0x68, 0x5B, 0x14, 0x48, 0xB7, 0x55,<br>&gt;    0xD5, 0x6F, 0x70, 0x1A, 0xFE, 0x9B, 0xE2, 0xCE<br>&gt;  }<br>&gt;   ... shortened for clarity ...<br>&gt; }<br>&gt; There are 16384	elements in this array.  The C compiler accepts it with no difficulty<br>&gt; <br>&gt; I converted it to a .swift file like so:<br>&gt; <br>&gt; let blake2b_kat: [[UInt8]] =<br>&gt; [<br>&gt; [<br>&gt;  0x78, 0x6A, 0x02, 0xF7, 0x42, 0x01, 0x59, 0x03,<br>&gt;  0xC6, 0xC6, 0xFD, 0x85, 0x25, 0x52, 0xD2, 0x72,<br>&gt;  0x91, 0x2F, 0x47, 0x40, 0xE1, 0x58, 0x47, 0x61,<br>&gt;  0x8A, 0x86, 0xE2, 0x17, 0xF7, 0x1F, 0x54, 0x19,<br>&gt;  0xD2, 0x5E, 0x10, 0x31, 0xAF, 0xEE, 0x58, 0x53,<br>&gt;  0x13, 0x89, 0x64, 0x44, 0x93, 0x4E, 0xB0, 0x4B,<br>&gt;  0x90, 0x3A, 0x68, 0x5B, 0x14, 0x48, 0xB7, 0x55,<br>&gt;  0xD5, 0x6F, 0x70, 0x1A, 0xFE, 0x9B, 0xE2, 0xCE<br>&gt; ]<br>&gt; ...<br>&gt; ]<br>&gt; <br>&gt; When I attempt a swift compile, the compiler seems to go away and never return.  I tried the same test with the REPL and saw all the text list (2600 lines), but then the same thing happened.  I left the REPL running for 10 minutes or so, with no output. I have tried the same swift table definition with fewer rows and columns, and it produces the correct 2D array.<br>&gt; <br>&gt; My question is whether this is just an issue with the current Swift compiler (I am using the May 9th version for Ubuntu 14.04) or is this a recognized limitation in scale?  In order to get my 2D table filled and work around this issue, I will have to read the file with file I/O and do my own parsing.<br>&gt; -- <br>&gt; Ken Burgett<br>&gt; Principal Software Engineer<br>&gt; Email: kenb at iotone.io<br>&gt; Office: 530.693.4449<br>&gt; Mobile: 831.332.6846<br>&gt; URL: www.iotone.co<br>&gt; _______________________________________________<br>&gt; swift-users mailing list<br>&gt; swift-users at swift.org<br>&gt; https://lists.swift.org/mailman/listinfo/swift-users<br></p></div></li></ul></li></ul></div>    </main>
    <script src="/js/app-c283ee129de63ad743722e9511e67a5d.js"></script>
  </body>
  <footer>
    <p>Swift and the Swift logo are trademarks of Apple Inc.</p>
  </footer>
</html>
