<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Swift Mailing List Archive</title>
    <link rel="stylesheet" href="/css/app-13f065ae5e595562a5022c544e3b976c.css?vsn=d">
  </head>

  <body>
    <div class="container">
      <header class="header">
        <img src="/images/swift-d0237fc716ba0932a940049990beba1b.svg?vsn=d" height="70">
      </header>

      <p class="alert alert-info" role="alert"></p>
      <p class="alert alert-danger" role="alert"></p>

    </div> <!-- /container -->
    <main role="main">
<div class="comment-wrapper"><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/e01e37acbfad671da1b94a61cf819d82?s=50"></div><header><strong>Compiler crash: AST verification error: archetype Element not allowed in this context</strong> from <string>Kenny Leung</string> &lt;kenny_leung at pobox.com&gt;<p>June  7, 2016 at 10:00:00am</p></header><div class="content"><p>Hi All.<br></p><p>I have some incorrect code that is causing a compiler crash. Can somebody comment on whether this is worth a bug report? I was unable to match anything in JIRA.<br></p><p>The code can be found here: https://github.com/pepperdog/PepperDogFetch/tree/CompilerCrash-1<br></p><p>With some guidance as to what’s wrong, I may be able to make an isolated test, but as it is, there are too many layers.<br></p><p>Thanks!<br></p><p>-Kenny<br></p><p>—— cut here 8&lt;——8&lt;——<br>CompileSwift normal x86_64 /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift<br>    cd /Users/kenny/Projects/PepperDogFetch/iOSProject<br>    /Users/kenny/Library/Developer/Toolchains/swift-DEVELOPMENT-SNAPSHOT-2016-05-31-a.xctoolchain/usr/bin/swift -frontend -c -primary-file /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Constraint.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PostgreSQLDatabase/PostgreSQLDatabase.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Column.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/SQLConvertible.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Row.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Table.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PepperDogFetch.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/DatabaseConnection.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/Database.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PostgreSQLDatabase/PostgreSQLConnection.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/ConnectionPool.swift -target x86_64-apple-ios9.3 -enable-objc-interop -sdk /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator9.3.sdk -I /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator -F /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator -F /Users/kenny/Projects/PepperDogFetch/iOSProject/../ThirdParty -enable-testing -g -import-underlying-module -module-cache-path /Users/kenny/build/ModuleCache -serialize-debugging-options -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/swift-overrides.hmap -Xcc -iquote -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-generated-files.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-own-target-headers.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-all-non-framework-target-headers.hmap -Xcc -ivfsoverlay -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/all-product-headers.yaml -Xcc -iquote -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-project-headers.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator/include -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/DerivedSources/x86_64 -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/DerivedSources -Xcc -DDEBUG=1 -Xcc -ivfsoverlay -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/unextended-module-overlay.yaml -Xcc -working-directory/Users/kenny/Projects/PepperDogFetch/iOSProject -emit-module-doc-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet~partial.swiftdoc -Onone -module-name PepperDogFetch -emit-module-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet~partial.swiftmodule -serialize-diagnostics-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.dia -emit-dependencies-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.d -emit-reference-dependencies-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.swiftdeps -o /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.o<br></p><p>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:73:100: error: reference to generic type &#39;ResultSet.Iterator&#39; requires arguments in &lt;...&gt;<br>    public func filter(_ includeElement: @noescape (Iterator.Element) throws -&gt; Bool) rethrows -&gt; [Iterator.Element] {<br>                                                                                                   ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:104:18: note: generic type &#39;Iterator&#39; declared here<br>    public class Iterator&lt;Element&gt; : IteratorProtocol {<br>                 ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:77:44: error: reference to generic type &#39;ResultSet.Iterator&#39; requires arguments in &lt;...&gt;<br>    public func forEach(_ body: @noescape (Iterator.Element) throws -&gt; Swift.Void) rethrows {<br>                                           ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:104:18: note: generic type &#39;Iterator&#39; declared here<br>    public class Iterator&lt;Element&gt; : IteratorProtocol {<br>                 ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:96:96: error: reference to generic type &#39;ResultSet.Iterator&#39; requires arguments in &lt;...&gt;<br>    public func split(maxSplits: Int, omittingEmptySubsequences: Bool, isSeparator: @noescape (Iterator.Element) throws -&gt; Bool) rethrows -&gt; [ResultSet] {<br>                                                                                               ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:104:18: note: generic type &#39;Iterator&#39; declared here<br>    public class Iterator&lt;Element&gt; : IteratorProtocol {<br>                 ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:100:92: error: reference to generic type &#39;ResultSet.Iterator&#39; requires arguments in &lt;...&gt;<br>    public func first(where: @noescape (Self.Iterator.Element) throws -&gt; Bool) rethrows -&gt; Iterator.Element?<br>                                                                                           ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:104:18: note: generic type &#39;Iterator&#39; declared here<br>    public class Iterator&lt;Element&gt; : IteratorProtocol {<br>                 ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:104:18: error: generic type &#39;Iterator&#39; nested in type &#39;ResultSet&#39; is not allowed<br>    public class Iterator&lt;Element&gt; : IteratorProtocol {<br>                 ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:11:14: error: type &#39;ResultSet&#39; does not conform to protocol &#39;Sequence&#39;<br>public class ResultSet : Sequence {<br>             ^<br>Swift.Sequence:124:17: note: protocol requires function &#39;makeIterator()&#39; with type &#39;() -&gt; ResultSet.Iterator&#39;<br>    public func makeIterator() -&gt; Self.Iterator<br>                ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:51:17: note: candidate has non-matching type &#39;() -&gt; ResultSet.Iterator&#39; [with SubSequence = AnySequence&lt;Element&gt;]<br>    public func makeIterator() -&gt; ResultSet.Iterator {<br>                ^<br>Swift.Sequence:5:17: note: candidate has non-matching type &#39;&lt;Self&gt; () -&gt; Self&#39; (aka &#39;&lt;τ_0_0&gt; () -&gt; τ_0_0&#39;) [with SubSequence = AnySequence&lt;Element&gt;]<br>    public func makeIterator() -&gt; Self<br>                ^<br>Swift.Sequence:3:17: note: candidate has non-matching type &#39;&lt;Self&gt; () -&gt; Self.Base.Iterator&#39; (aka &#39;&lt;τ_0_0&gt; () -&gt; τ_0_0.Base.Iterator&#39;) [with SubSequence = AnySequence&lt;Element&gt;]<br>    public func makeIterator() -&gt; Self.Iterator<br>                ^<br>/Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:52:34: error: cannot invoke value of type &#39;ResultSet.Iterator&lt;_&gt;.Type&#39; with argument list &#39;()&#39;<br>        return ResultSet.Iterator()<br>               ~~~~~~~~~~~~~~~~~~^<br>AST verification error: archetype Element not allowed in this context<br>archetype came from:<br></p><p>0  swift                    0x000000010669366b llvm::sys::PrintStackTrace(llvm::raw_ostream&amp;) + 43<br>1  swift                    0x00000001066928f6 llvm::sys::RunSignalHandlers() + 70<br>2  swift                    0x0000000106693d3f SignalHandler(int) + 383<br>3  libsystem_platform.dylib 0x00007fff8f45b52a _sigtramp + 26<br>4  swift                    0x0000000107274b18 clang::vfs::getNextVirtualUniqueID()::UID + 75840<br>5  swift                    0x0000000106693b16 abort + 22<br>6  swift                    0x0000000104357a8d (anonymous namespace)::Verifier::verifyChecked(swift::Type, llvm::SmallPtrSet&lt;swift::ArchetypeType*, 4u&gt;&amp;) + 109<br>7  swift                    0x000000010435feba (anonymous namespace)::Verifier::verifyCheckedAlways(swift::ValueDecl*) + 154<br>8  swift                    0x0000000104355413 (anonymous namespace)::Verifier::walkToDeclPost(swift::Decl*) + 1331<br>9  swift                    0x000000010436775c (anonymous namespace)::Traversal::doIt(swift::Decl*) + 1580<br>10 swift                    0x000000010436985f (anonymous namespace)::Traversal::visitParameterList(swift::ParameterList*) + 95<br>11 swift                    0x000000010436bd9b (anonymous namespace)::Traversal::visitAbstractFunctionDecl(swift::AbstractFunctionDecl*) + 1003<br>12 swift                    0x0000000104367233 (anonymous namespace)::Traversal::doIt(swift::Decl*) + 259<br>13 swift                    0x000000010436b984 (anonymous namespace)::Traversal::visitNominalTypeDecl(swift::NominalTypeDecl*) + 260<br>14 swift                    0x000000010436721f (anonymous namespace)::Traversal::doIt(swift::Decl*) + 239<br>15 swift                    0x000000010436711b swift::Decl::walk(swift::ASTWalker&amp;) + 27<br>16 swift                    0x0000000104418dca swift::SourceFile::walk(swift::ASTWalker&amp;) + 170<br>17 swift                    0x000000010434b8b1 swift::verify(swift::SourceFile&amp;) + 65<br>18 swift                    0x000000010428f50e swift::performTypeChecking(swift::SourceFile&amp;, swift::TopLevelContext&amp;, swift::OptionSet&lt;swift::TypeCheckingFlags, unsigned int&gt;, unsigned int, unsigned int) + 1710<br>19 swift                    0x0000000103f4e4ff swift::CompilerInstance::performSema() + 5135<br>20 swift                    0x0000000103a64a40 performCompile(swift::CompilerInstance&amp;, swift::CompilerInvocation&amp;, llvm::ArrayRef&lt;char const*&gt;, int&amp;, swift::FrontendObserver*) + 448<br>21 swift                    0x0000000103a6397f swift::performFrontend(llvm::ArrayRef&lt;char const*&gt;, char const*, void*, swift::FrontendObserver*) + 2895<br>22 swift                    0x0000000103a26ad0 main + 2688<br>23 libdyld.dylib            0x00007fff8adbe5ad start + 1<br>Stack dump:<br>0.	Program arguments: /Users/kenny/Library/Developer/Toolchains/swift-DEVELOPMENT-SNAPSHOT-2016-05-31-a.xctoolchain/usr/bin/swift -frontend -c -primary-file /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Constraint.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PostgreSQLDatabase/PostgreSQLDatabase.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Column.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/SQLConvertible.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Row.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/Table.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PepperDogFetch.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/DatabaseConnection.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/Database.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/PostgreSQLDatabase/PostgreSQLConnection.swift /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/DatabaseLayer/ConnectionPool.swift -target x86_64-apple-ios9.3 -enable-objc-interop -sdk /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator9.3.sdk -I /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator -F /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator -F /Users/kenny/Projects/PepperDogFetch/iOSProject/../ThirdParty -enable-testing -g -import-underlying-module -module-cache-path /Users/kenny/build/ModuleCache -serialize-debugging-options -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/swift-overrides.hmap -Xcc -iquote -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-generated-files.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-own-target-headers.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-all-non-framework-target-headers.hmap -Xcc -ivfsoverlay -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/all-product-headers.yaml -Xcc -iquote -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/PepperDogFetch-project-headers.hmap -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Products/Debug-iphonesimulator/include -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/DerivedSources/x86_64 -Xcc -I/Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/DerivedSources -Xcc -DDEBUG=1 -Xcc -ivfsoverlay -Xcc /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/unextended-module-overlay.yaml -Xcc -working-directory/Users/kenny/Projects/PepperDogFetch/iOSProject -emit-module-doc-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet~partial.swiftdoc -Onone -module-name PepperDogFetch -emit-module-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet~partial.swiftmodule -serialize-diagnostics-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.dia -emit-dependencies-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.d -emit-reference-dependencies-path /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.swiftdeps -o /Users/kenny/build/PepperDogFetch-esuqrverwjrarebailkxzerpnzax/Build/Intermediates/PepperDogFetch.build/Debug-iphonesimulator/PepperDogFetch.build/Objects-normal/x86_64/ResultSet.o <br>1.	While walking into decl &#39;ResultSet&#39; at /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:11:8<br>2.	While walking into body of &#39;map&#39; at /Users/kenny/Projects/PepperDogFetch/PepperDogFetch/RelationalLayer/ResultSet.swift:69:12<br>--------------------------------<br></p></div></li></ul></div>    </main>
    <script src="/js/app-c283ee129de63ad743722e9511e67a5d.js?vsn=d"></script>
  </body>
  <footer>
    <p>Swift and the Swift logo are trademarks of Apple Inc.</p>
  </footer>
</html>
