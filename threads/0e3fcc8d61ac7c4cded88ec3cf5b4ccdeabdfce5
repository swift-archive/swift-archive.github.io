<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Swift Mailing List Archive</title>
    <link rel="stylesheet" href="/css/app-13f065ae5e595562a5022c544e3b976c.css?vsn=d">
  </head>

  <body>
    <div class="container">
      <header class="header">
        <img src="/images/swift-d0237fc716ba0932a940049990beba1b.svg?vsn=d" height="70">
      </header>

      <p class="alert alert-info" role="alert"></p>
      <p class="alert alert-danger" role="alert"></p>

    </div> <!-- /container -->
    <main role="main">
<div class="comment-wrapper"><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/411a0fa16436bc975292f7044033a246?s=50"></div><header><strong>problems with linking .tbd frameworks in test suite</strong> from <string>Alex Lew</string> &lt;alexl.mail+swift at gmail.com&gt;<p>December 10, 2015 at 12:00:00am</p></header><div class="content"><p>Hi all,<br></p><p>Apologies if this is not the right place to ask this.<br></p><p>I built Swift successfully today, but was failing lots of tests because the<br>linker couldn&#39;t find CoreFoundation (or other frameworks, including<br>libsystem and libobjc). It looks like  ld was invoked with the arguments:<br></p><p> -syslibroot<br>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk<br></p><p>The MacOSX10.11.sdk/usr/lib directory *did* have the desired<br>libraries/frameworks in it, but they had the extension .tbd, not .dylib,<br>and I think that confused the linker. I commented out the following lines<br>from swift/lib/Driver/ToolChains.cpp:<br></p><p><br>  if (!context.OI.SDKPath.empty()) {<br>    Arguments.push_back(&quot;-syslibroot&quot;);<br>    Arguments.push_back(context.Args.MakeArgString(context.OI.SDKPath));<br>  }<br></p><p>(lines 915-918), reran util/build-script -t, and everything started working<br>(presumably because the linker was now searching in /usr/lib, where the<br>dylib files are).<br></p><p>I&#39;m curious to understand what was going on here. Should I have been using<br>a different version of ld? Configured something else differently? I&#39;m in a<br>little over my head.<br></p><p>Thank you!<br></p><p>-Alex<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20151210/0e3ffce5/attachment.html&gt;<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/5d9baa679148bd83458d11df12327ce0?s=50"></div><header><strong>problems with linking .tbd frameworks in test suite</strong> from <string>Daniel Dunbar</string> &lt;daniel_dunbar at apple.com&gt;<p>December  9, 2015 at 09:00:00pm</p></header><div class="content"><p>What version of ld are you using? (ld -v)<br></p><p>If you have .tbd files in your SDK, then the ld that shipped with that version of Xcode should be capable of using them to link. The tools should be using that version of ld by default, but it is possible something is going wrong.<br></p><p>If might help to run the command that is failing with &quot;-v&quot;, and include the full command and its errors.<br></p><p> - Daniel<br></p><p>&gt; On Dec 9, 2015, at 9:10 PM, Alex Lew via swift-dev &lt;swift-dev at swift.org&gt; wrote:<br>&gt; <br>&gt; Hi all,<br>&gt; <br>&gt; Apologies if this is not the right place to ask this.<br>&gt; <br>&gt; I built Swift successfully today, but was failing lots of tests because the linker couldn&#39;t find CoreFoundation (or other frameworks, including libsystem and libobjc). It looks like  ld was invoked with the arguments:<br>&gt; <br>&gt;  -syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk<br>&gt; <br>&gt; The MacOSX10.11.sdk/usr/lib directory did have the desired libraries/frameworks in it, but they had the extension .tbd, not .dylib, and I think that confused the linker. I commented out the following lines from swift/lib/Driver/ToolChains.cpp:<br>&gt; <br>&gt; <br>&gt;   if (!context.OI.SDKPath.empty()) {<br>&gt;     Arguments.push_back(&quot;-syslibroot&quot;);<br>&gt;     Arguments.push_back(context.Args.MakeArgString(context.OI.SDKPath));<br>&gt;   }<br>&gt; <br>&gt; (lines 915-918), reran util/build-script -t, and everything started working (presumably because the linker was now searching in /usr/lib, where the dylib files are).<br>&gt; <br>&gt; I&#39;m curious to understand what was going on here. Should I have been using a different version of ld? Configured something else differently? I&#39;m in a little over my head.<br>&gt; <br>&gt; Thank you!<br>&gt; <br>&gt; -Alex<br>&gt;  _______________________________________________<br>&gt; swift-dev mailing list<br>&gt; swift-dev at swift.org<br>&gt; https://lists.swift.org/mailman/listinfo/swift-dev<br></p><p>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20151209/6ee9742c/attachment.html&gt;<br></p></div><ul class="comments"><li class="comment"><div class="avatar"><img src="https://www.gravatar.com/avatar/411a0fa16436bc975292f7044033a246?s=50"></div><header><strong>problems with linking .tbd frameworks in test suite</strong> from <string>Alex Lew</string> &lt;alexl.mail+swift at gmail.com&gt;<p>December 10, 2015 at 12:00:00am</p></header><div class="content"><p>Gahh... yep, turns out I was using an old MacPorts version of ld. I thought<br>I&#39;d cleared out gcc, ld, etc. from /opt/local/bin a while ago, but I guess<br>not. Should have been my first thought. Thanks! And sorry for bothering!<br></p><p>-Alex<br></p><p>On Thu, Dec 10, 2015 at 12:25 AM, Daniel Dunbar &lt;daniel_dunbar at apple.com&gt;<br>wrote:<br></p><p>&gt; What version of ld are you using? (ld -v)<br>&gt;<br>&gt; If you have .tbd files in your SDK, then the ld that shipped with that<br>&gt; version of Xcode should be capable of using them to link. The tools should<br>&gt; be using that version of ld by default, but it is possible something is<br>&gt; going wrong.<br>&gt;<br>&gt; If might help to run the command that is failing with &quot;-v&quot;, and include<br>&gt; the full command and its errors.<br>&gt;<br>&gt;  - Daniel<br>&gt;<br>&gt; On Dec 9, 2015, at 9:10 PM, Alex Lew via swift-dev &lt; swift-dev at swift.org&gt;<br>&gt; wrote:<br>&gt;<br>&gt; Hi all,<br>&gt;<br>&gt; Apologies if this is not the right place to ask this.<br>&gt;<br>&gt; I built Swift successfully today, but was failing lots of tests because<br>&gt; the linker couldn&#39;t find CoreFoundation (or other frameworks, including<br>&gt; libsystem and libobjc). It looks like  ld was invoked with the arguments:<br>&gt;<br>&gt;  -syslibroot<br>&gt; /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk<br>&gt;<br>&gt;<br>&gt; The MacOSX10.11.sdk/usr/lib directory *did* have the desired<br>&gt; libraries/frameworks in it, but they had the extension .tbd, not .dylib,<br>&gt; and I think that confused the linker. I commented out the following lines<br>&gt; from swift/lib/Driver/ToolChains.cpp:<br>&gt;<br>&gt;<br>&gt;   if (!context.OI.SDKPath.empty()) {<br>&gt;     Arguments.push_back(&quot;-syslibroot&quot;);<br>&gt;     Arguments.push_back(context.Args.MakeArgString(context.OI.SDKPath));<br>&gt;   }<br>&gt;<br>&gt; (lines 915-918), reran util/build-script -t, and everything started<br>&gt; working (presumably because the linker was now searching in /usr/lib, where<br>&gt; the dylib files are).<br>&gt;<br>&gt; I&#39;m curious to understand what was going on here. Should I have been using<br>&gt; a different version of ld? Configured something else differently? I&#39;m in a<br>&gt; little over my head.<br>&gt;<br>&gt; Thank you!<br>&gt;<br>&gt; -Alex<br>&gt; _______________________________________________<br>&gt; swift-dev mailing list<br>&gt; swift-dev at swift.org<br>&gt; https://lists.swift.org/mailman/listinfo/swift-dev<br>&gt;<br>&gt;<br>&gt;<br>-------------- next part --------------<br>An HTML attachment was scrubbed...<br>URL: &lt;https://lists.swift.org/pipermail/swift-dev/attachments/20151210/9ff86536/attachment.html&gt;<br></p></div></li></ul></li></ul></li></ul></div>    </main>
    <script src="/js/app-c283ee129de63ad743722e9511e67a5d.js?vsn=d"></script>
  </body>
  <footer>
    <p>Swift and the Swift logo are trademarks of Apple Inc.</p>
  </footer>
</html>
